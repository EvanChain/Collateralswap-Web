(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9224],{16910:(e,t,a)=>{Promise.resolve().then(a.bind(a,18423))},18423:(e,t,a)=>{"use strict";a.d(t,{default:()=>K});var r=a(67209),s=a(26877),l=a(78656),o=a(8498),n=a(91375),i=a(34242),c=a(88671);let d=n.bL,u=n.l9,m=n.ZL;n.bm;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.hJ,{ref:t,className:(0,c.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});g.displayName=n.hJ.displayName;let x=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(m,{children:[(0,r.jsx)(g,{}),(0,r.jsxs)(n.UC,{ref:t,className:(0,c.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[s,(0,r.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=n.UC.displayName;let h=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,c.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};h.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,c.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.hE,{ref:t,className:(0,c.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});f.displayName=n.hE.displayName;let w=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.VY,{ref:t,className:(0,c.cn)("text-sm text-muted-foreground",a),...s})});w.displayName=n.VY.displayName;var v=a(35020),y=a(11658),b=a(68376),j=a(58365),N=a(98334),A=a(19398),k=a(7547),C=a(73022),P=a(41218),E=a(49065),I=a(51688),S=a(31250),O=a(66252),T=a(92693),M=a(77084),D=a(71348),U=a(3299),V=a(12725),_=a(9899),R=a(36364);class F{async getUserAavePositions(e){if(R.iP.GLOBAL_MOCK_MODE||R.iP.USE_MOCK_AAVE)return(0,R.XG)("AAVE","Using mock data for getUserAavePositions",{userAddress:e}),await (0,R.G1)(),R.yk.getAavePositions(e);try{if(console.log("Starting to fetch Aave positions for:",e),!P.isAddress(e))throw Error("Invalid user address");let[t,a]=await Promise.all([this.uiPoolDataProvider.getReservesHumanized({lendingPoolAddressProvider:this.poolAddressProvider}),this.uiPoolDataProvider.getUserReservesHumanized({lendingPoolAddressProvider:this.poolAddressProvider,user:e})]);console.log("Raw reserves data:",t),console.log("Raw user reserves data:",a);let r=(0,U.HU)({reserves:t.reservesData,currentTimestamp:Date.now(),marketReferenceCurrencyDecimals:18,marketReferencePriceInUsd:"1"}),s=(0,V.x)({currentTimestamp:Date.now(),marketReferencePriceInUsd:"1",marketReferenceCurrencyDecimals:18,userReserves:a.userReserves,formattedReserves:r,userEmodeCategoryId:a.userEmodeCategoryId});console.log("Formatted user summary:",s);let l=[];return a.userReserves.forEach((e,t)=>{let a=r.find(t=>t.underlyingAsset.toLowerCase()===e.underlyingAsset.toLowerCase());if(!a){console.warn("Reserve not found for asset: ".concat(e.underlyingAsset));return}console.log("Processing user reserve ".concat(t,":"),{userReserve:e,reserve:a});let s=a.symbol,o=e.underlyingAsset,n=a.decimals;try{let t=E.gH.from(e.scaledATokenBalance||"0");if(!t.isZero()){let e=I.parseUnits(a.liquidityIndex,27);if(t.gt(S.Is.div(e))){console.warn("Potential overflow detected for ".concat(s," collateral calculation"));return}let r=t.mul(e).div(E.gH.from(10).pow(27)),i=parseFloat(I.formatUnits(r,n));if(i>1e-4){let e={id:"".concat(o,"-collateral"),type:"collateral",token:s,amount:r.toString(),formattedAmount:i.toFixed(6),tokenAddress:o};console.log("Adding collateral position:",e),l.push(e)}}}catch(e){console.error("Error processing collateral for ".concat(s,":"),e)}try{let t=E.gH.from(e.scaledVariableDebt||"0");if(!t.isZero()){let e=I.parseUnits(a.variableBorrowIndex,27);if(t.gt(S.Is.div(e))){console.warn("Potential overflow detected for ".concat(s," debt calculation"));return}let r=t.mul(e).div(E.gH.from(10).pow(27)),i=parseFloat(I.formatUnits(r,n));if(i>1e-4){let e={id:"".concat(o,"-debt"),type:"debt",token:s,amount:r.toString(),formattedAmount:i.toFixed(6),tokenAddress:o};console.log("Adding debt position:",e),l.push(e)}}}catch(e){console.error("Error processing debt for ".concat(s,":"),e)}}),console.log("Final positions from contracts:",l),l}catch(e){return console.error("Error fetching Aave positions from contracts:",e),console.error("Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),[]}}async getUserAavePositionsSimple(e){return await this.getUserAavePositions(e)}constructor(e){this.provider=e,this.chainId=T.nU.sepolia,this.poolAddressProvider=_.MP,this.uiPoolDataProvider=new M.e({uiPoolDataProviderAddress:_.T$,provider:this.provider,chainId:this.chainId}),this.uiIncentiveDataProvider=new D.H({uiIncentiveDataProviderAddress:_.oM,provider:this.provider,chainId:this.chainId})}}let L=async e=>{try{let t;if(R.iP.GLOBAL_MOCK_MODE||R.iP.USE_MOCK_AAVE){(0,R.XG)("AAVE","Creating mock-aware AaveUtils instance");let t=e||new O.F("http://localhost:8545");return new F(t)}if(console.log("Initializing Aave utils with contract helpers..."),e)t=e;else{let e=A.wi.RPC_URL||A.wi.SEPOLIA_RPC_URL;t=new O.F(e)}console.log("Creating AaveUtils instance with provider...");let a=new F(t);return console.log("AaveUtils created successfully for contract usage"),a}catch(e){return console.error("Error creating Aave utils:",e),console.error("Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),null}};class G{async migratePosition(e){try{if((0,R.XG)("MIGRATION","Starting position migration",e),R.iP.GLOBAL_MOCK_MODE||R.iP.USE_MOCK_CONTRACTS)return await this.mockMigratePosition(e);return await this.realMigratePosition(e)}catch(e){return console.error("Migration failed:",e),{success:!1,error:e instanceof Error?e.message:"Unknown migration error"}}}async mockMigratePosition(e){(0,R.XG)("MIGRATION","Using mock migration",e),await (0,R.G1)(1200);let{userAddress:t,aavePosition:a,migrationType:r}=e;try{if("aaveToVault"===r)return await this.mockMigrateToVault(t,a,e);return await this.mockCreateMigrationOrder(t,a,e)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Mock migration failed"}}}async mockMigrateToVault(e,t,a){(0,R.XG)("MIGRATION","Mock migration to vault",{userAddress:e,aavePosition:t,request:a});let r={userAddress:a.userAddress,aavePosition:a.aavePosition,migrationType:a.migrationType,collateralToken:a.collateralToken,collateralAmount:a.collateralAmount,debtToken:a.debtToken,debtAmount:a.debtAmount,price:a.price,interestRateMode:a.interestRateMode||"variable"},s=R.yk.simulateNewMigration(r);return s.success?{success:!0,pivPosition:s.pivPosition,order:s.order?{_id:s.order._id,orderId:s.order.orderId,owner:e,collateralToken:a.collateralToken,debtToken:a.debtToken,collateralAmount:a.collateralAmount,price:a.price||"1",status:"OPEN",filledAmount:"0",interestRateMode:a.interestRateMode,isFromBlockchain:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}:void 0,transactionHash:"0x".concat(Math.random().toString(16).substr(2,64))}:{success:!1,error:s.error||"Migration failed"}}async mockCreateMigrationOrder(e,t,a){(0,R.XG)("MIGRATION","Mock creation of migration order",{userAddress:e,aavePosition:t,request:a});let r=a.collateralToken,s=a.debtToken,l=a.collateralAmount;try{let o={owner:e,collateralToken:r,debtToken:s,collateralAmount:l,price:a.price||this.calculateMigrationPrice(r,s),interestRateMode:a.interestRateMode||"variable"},n=await C.N.createOrder(o);return R.yk.removeAavePosition(e,t.id),{success:!0,order:n,transactionHash:"0x".concat(Math.random().toString(16).substr(2,64))}}catch(e){throw Error("Failed to create migration order: ".concat(e instanceof Error?e.message:"Unknown error"))}}async realMigratePosition(e){throw Error("Real migration not implemented yet")}calculateMigrationPrice(e,t){let a={ETH:3e3,WBTC:45e3,USDC:1,USDT:1,DAI:1,LINK:15,AAVE:100},r=a[e]||1;return((a[t]||1)/r*.98).toFixed(6)}async getMigrationHistory(e){return R.iP.GLOBAL_MOCK_MODE||R.iP.USE_MOCK_API?(await (0,R.G1)(),R.yk.getOrders().filter(t=>{var a;return t.owner.toLowerCase()===e.toLowerCase()&&(null===(a=t.orderId)||void 0===a?void 0:a.includes("MIGRATE"))})):[]}canMigrate(e){return e.amount&&"0"!==e.amount?1e-4>parseFloat(e.formattedAmount)?{canMigrate:!1,reason:"Position amount too small"}:{canMigrate:!0}:{canMigrate:!1,reason:"Position amount is zero"}}async estimateMigrationCost(e){return await (0,R.G1)(500),{estimatedGas:"350000",estimatedCostUSD:"25.50"}}}let B=new G;class W{async getUserPivPositions(e){return(0,R.XG)("PIV","Getting user PIV positions",{userAddress:e}),await (0,R.G1)(),R.yk.getPivPositions().filter(t=>t.id.includes(e.toLowerCase())||!0)}async createOrder(e,t,a,r,s){(0,R.XG)("PIV","Creating PIV order",{owner:e,collateralToken:t,debtToken:a,collateralAmount:r,price:s}),await (0,R.G1)();try{let e="PIV_".concat(Date.now()),a={id:"piv-".concat(t.toLowerCase(),"-").concat(Date.now()),type:"collateral",token:t,amount:I.parseUnits(r,18).toString(),formattedAmount:r,tokenAddress:this.getTokenAddress(t),orderId:e};return R.yk.addPivPosition(a),{success:!0,orderId:e}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async fillOrder(e,t){(0,R.XG)("PIV","Filling PIV order",{orderId:e,fillAmount:t}),await (0,R.G1)();try{return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async cancelOrder(e){(0,R.XG)("PIV","Cancelling PIV order",{orderId:e}),await (0,R.G1)();try{return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getAllOrders(){return(0,R.XG)("PIV","Getting all PIV orders"),await (0,R.G1)(),R.yk.getOrders().map(e=>({id:e._id,owner:e.owner,collateralToken:e.collateralToken,debtToken:e.debtToken,collateralAmount:e.collateralAmount,price:e.price,status:e.status}))}async getUserOrders(e){return(0,R.XG)("PIV","Getting user PIV orders",{userAddress:e}),await (0,R.G1)(),(await this.getAllOrders()).filter(t=>t.owner.toLowerCase()===e.toLowerCase())}getTokenAddress(e){return({ETH:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",WBTC:"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",USDC:"0xA0b86a33E6441A3063BdFb663c6C8FAc6C8A4Ec2",USDT:"0xdAC17F958D2ee523a2206206994597C13D831ec7",DAI:"0x6B175474E89094C44Da98b954EedeAC495271d0F",LINK:"0x514910771AF9Ca656af840dff83E8264EcF986CA",AAVE:"0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9"})[e]||"0x0000000000000000000000000000000000000000"}constructor(){this.contractAddress=A.wi.PIV_ADDRESS}}let z=async()=>{try{if(R.iP.GLOBAL_MOCK_MODE||R.iP.USE_MOCK_CONTRACTS)return(0,R.XG)("PIV","Creating mock PIV utils instance"),new W;return(0,R.XG)("PIV","Mock mode disabled - would create real PIV contract interface"),new W}catch(e){return console.error("Error creating PIV utils:",e),null}},H=[{id:1,debt:{token:"USDC",amount:5e3},collateral:{token:"WBTC",amount:1}},{id:2,debt:{token:"LINK",amount:300},collateral:{token:"UNI",amount:50}},{id:3,debt:{token:"AAVE",amount:10},collateral:{token:"CRV",amount:200}}];function K(){let[e,t]=(0,s.useState)(!1),[a,n]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[m,g]=(0,s.useState)(""),[P,E]=(0,s.useState)(""),[I,S]=(0,s.useState)(""),[O,T]=(0,s.useState)(""),[M,D]=(0,s.useState)(""),[U,V]=(0,s.useState)(""),[_,F]=(0,s.useState)([]),[G,W]=(0,s.useState)(!1),[K,X]=(0,s.useState)(null),[$,Z]=(0,s.useState)(""),[J,q]=(0,s.useState)([]),[Y,Q]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(null),[ea,er]=(0,s.useState)([]),[es,el]=(0,s.useState)(!1),[eo,en]=(0,s.useState)(!1),{isConnected:ei,address:ec}=function(){let{account:e}=(0,k.A)(),[t,a]=(0,s.useState)(!1),[r,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let t=!!(null==e?void 0:e.address);a(t),l(t?e.address:null),console.log("Wallet state updated:",{connected:t,address:null==e?void 0:e.address,account:e})},[e]),{isConnected:t,address:r,account:e}}(),{provider:ed}=function(){let[e,t]=(0,s.useState)({isConnected:!1,address:null,provider:null,isLoading:!1,error:null}),a=(0,s.useCallback)(async()=>{if(window.ethereum)try{let e=new j.j(window.ethereum),a=await e.listAccounts();a.length>0&&t({isConnected:!0,address:a[0],provider:e,isLoading:!1,error:null})}catch(e){console.error("Error checking wallet connection:",e)}},[]),r=(0,s.useCallback)(async()=>{if(!window.ethereum){t(e=>({...e,error:"MetaMask not installed"}));return}t(e=>({...e,isLoading:!0,error:null}));try{let e=new j.j(window.ethereum);await e.send("eth_requestAccounts",[]);let a=e.getSigner(),r=await a.getAddress();t({isConnected:!0,address:r,provider:e,isLoading:!1,error:null})}catch(e){t(t=>({...t,isLoading:!1,error:e.message||"Failed to connect wallet"}))}},[]),l=(0,s.useCallback)(()=>{t({isConnected:!1,address:null,provider:null,isLoading:!1,error:null})},[]);return(0,s.useEffect)(()=>{if(window.ethereum){let e=e=>{0===e.length?l():a()},t=()=>{window.location.reload()};return window.ethereum.on("accountsChanged",e),window.ethereum.on("chainChanged",t),a(),()=>{window.ethereum&&(window.ethereum.removeListener("accountsChanged",e),window.ethereum.removeListener("chainChanged",t))}}},[a,l]),{...e,connectWallet:r,disconnectWallet:l}}(),{getTotalOrders:eu,getAtokenAddress:em,migrateFromAave:eg,placeOrder:ex,updateOrder:eh,cancelOrder:ep,previewSwap:ef,swap:ew}=function(){let e=()=>{if(!window.ethereum)throw Error("MetaMask not installed");return new j.j(window.ethereum).getSigner()},t=async()=>{let t=A.wi.PIV_ADDRESS;if("0x0000000000000000000000000000000000000000"===t)throw Error("PIV address not configured");return new N.NZ(t,A.D2.IPIV,await e())},a=(0,s.useCallback)(async()=>{let e=await t();return await e.ADDRESSES_PROVIDER()},[]),r=(0,s.useCallback)(async()=>{let e=await t();return await e.POOL()},[]),l=(0,s.useCallback)(async()=>{let e=await t();return await e.totalOrders()},[]),o=(0,s.useCallback)(async e=>{let a=await t();return await a.atokenAddress(e)},[]),n=(0,s.useCallback)(async e=>{let a=await t();return await a.getBalance(e)},[]),i=(0,s.useCallback)(async e=>{let a=await t();return await a.collateralOnSold(e)},[]),c=(0,s.useCallback)(async e=>{let a=await t();return await a.orderMapping(e)},[]),d=(0,s.useCallback)(async()=>{let e=await t();return await e.owner()},[]),u=(0,s.useCallback)(async(e,a,r,s,l)=>{let o=await t();return(await o.migrateFromAave(e,a,r,s,l)).wait()},[]),m=(0,s.useCallback)(async(e,a,r,s,l)=>{let o=await t();return(await o.placeOrder(e,a,r,s,l)).wait()},[]),g=(0,s.useCallback)(async(e,a)=>{let r=await t();return(await r.updateOrder(e,a)).wait()},[]),x=(0,s.useCallback)(async e=>{let a=await t();return(await a.cancelOrder(e)).wait()},[]),h=(0,s.useCallback)(async(e,a)=>{let r=await t();return await r.previewSwap(e,a)},[]),p=(0,s.useCallback)(async(e,a,r)=>{let s=await t();return(await s.swap(e,a,r)).wait()},[]),f=(0,s.useCallback)(async e=>{let a=await t();return(await a.transferOwnership(e)).wait()},[]);return{getAddressesProvider:a,getPool:r,getTotalOrders:l,getAtokenAddress:o,getBalance:n,getCollateralOnSold:i,getOrderMapping:c,getOwner:d,migrateFromAave:u,placeOrder:m,updateOrder:g,cancelOrder:x,previewSwap:h,swap:p,transferOwnership:f,renounceOwnership:(0,s.useCallback)(async()=>{let e=await t();return(await e.renounceOwnership()).wait()},[]),withdrawAssets:(0,s.useCallback)(async(e,a,r)=>{let s=await t();return(await s.withdrawAssets(e,a,r)).wait()},[])}}(),ev=(e,a)=>{if(n(e),c(a),"aaveToVault"===a&&"collateral"===e.type){g(e.token),E(e.formattedAmount);let t=J.filter(e=>"debt"===e.type);if(t.length>0){let e;let a=t.filter(e=>["USDC","USDT","DAI"].includes(e.token));S((e=a.length>0?a[0]:t.reduce((e,t)=>parseFloat(t.formattedAmount)>parseFloat(e.formattedAmount)?t:e)).token),T(e.formattedAmount),console.log("Auto-selected debt position:",e)}else S("USDC"),T("1000")}else"placeOrder"===a&&"collateral"===e.type&&(g(e.token),E(e.formattedAmount),S("USDC"),D(""));V("static"),t(!0)},ey=async()=>{if(!a||!m||!P||!U||!ec){alert("Please fill all migration details and ensure wallet is connected.");return}if("aaveToVault"===i&&(!I||!O)){alert("Please fill all debt details for migration.");return}if("placeOrder"===i&&(!I||!M)){alert("Please fill debt token and price for order creation.");return}let e=Number.parseFloat(P);if(isNaN(e)||e<=0){alert("Please enter a valid collateral amount.");return}if("aaveToVault"===i){let e=Number.parseFloat(O);if(isNaN(e)||e<=0){alert("Please enter a valid debt amount.");return}}if("placeOrder"===i){let e=Number.parseFloat(M);if(isNaN(e)||e<=0){alert("Please enter a valid price.");return}}en(!0);try{let e={userAddress:ec,aavePosition:a,migrationType:i,collateralToken:m,collateralAmount:P,debtToken:I,debtAmount:"aaveToVault"===i?O:void 0,price:"placeOrder"===i?M:void 0,interestRateMode:"static"===U?"stable":"variable"};console.log("Starting migration with request:",e);let r=await B.migratePosition(e);r.success?(console.log("Migration successful:",r),await Promise.all([eN(),ek(),eA()]),alert("Migration successful! ".concat(r.order?"Order created: "+r.order.orderId:"")),t(!1),n(null),c(null),g(""),E(""),S(""),T(""),D(""),V("")):(console.error("Migration failed:",r.error),alert("Migration failed: ".concat(r.error)))}catch(e){console.error("Migration error:",e),alert("Migration error: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{en(!1)}},eb=async(e,t)=>{if(!t||isNaN(Number.parseFloat(t))||0>=Number.parseFloat(t)){alert("Please enter a valid price.");return}try{await C.N.updateOrder(e,{price:t}),await ek(),X(null),Z(""),alert("Order updated successfully!")}catch(e){console.error("Error updating order:",e),alert("Failed to update order: ".concat(e instanceof Error?e.message:"Unknown error"))}},ej=async e=>{if(confirm("Are you sure you want to cancel this order?"))try{await C.N.cancelOrder(e),await ek(),alert("Order cancelled successfully!")}catch(e){console.error("Error cancelling order:",e),alert("Failed to cancel order: ".concat(e instanceof Error?e.message:"Unknown error"))}},eN=async()=>{if(ec){Q(!0),et(null);try{console.log("Fetching Aave positions for address:",ec);let e=await L(ed||void 0);if(e){let t=await e.getUserAavePositions(ec);console.log("Fetched Aave positions:",t),q(t)}else{let e="Failed to initialize Aave utils - using default RPC provider";console.error(e),et(e),q([])}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";console.error("Error fetching Aave positions:",t),et("Error fetching positions: ".concat(e)),q([])}finally{Q(!1)}}},eA=async()=>{if(ec){el(!0);try{let e=await z();if(e){let t=await e.getUserPivPositions(ec);er(t)}else er(R.yk.getPivPositions())}catch(e){console.error("Error fetching PIV positions:",e),er(R.yk.getPivPositions())}finally{el(!1)}}},ek=async()=>{W(!0);try{let e=await C.N.getOrders(ec||void 0);F(e)}catch(e){console.error("Error fetching orders:",e)}finally{W(!1)}};return(0,s.useEffect)(()=>{ei?ek():F([])},[ei]),(0,s.useEffect)(()=>{console.log("Wallet state:",{isConnected:ei,address:ec})},[ei,ec]),(0,s.useEffect)(()=>{ei&&ec?(console.log("Fetching positions for address:",ec),eN(),eA()):(console.log("Wallet not connected, clearing positions"),q([]),er([]))},[ei,ec]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{ei&&ec&&0===J.length&&!Y&&(console.log("Retrying Aave positions fetch after delay"),eN())},2e3);return()=>clearTimeout(e)},[ei,ec,J.length,Y]),(0,r.jsxs)(d,{open:e,onOpenChange:e=>{t(e),e||(n(null),c(null),g(""),E(""),S(""),T(""),D(""),V(""))},children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-6 p-4 min-h-[calc(100vh-120px)]",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 w-full max-w-6xl items-start",children:[(0,r.jsxs)(o.Zp,{className:"bg-white border-gray-200 text-gray-900 transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/10 w-full",children:[(0,r.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,r.jsx)(o.ZB,{children:"AAVE Position"}),ei&&(0,r.jsx)(l.$,{onClick:eN,disabled:Y,variant:"outline",size:"sm",className:"text-xs",children:Y?"Loading...":"Refresh"})]}),(0,r.jsx)(o.Wu,{className:"grid gap-4 max-h-[300px] overflow-y-auto",children:ei?Y?(0,r.jsx)("div",{className:"text-center py-4",children:"Loading Aave positions..."}):ee?(0,r.jsxs)("div",{className:"text-center py-4 text-red-500",children:[(0,r.jsx)("p",{className:"mb-2",children:ee}),(0,r.jsx)(l.$,{onClick:eN,variant:"outline",size:"sm",children:"Retry"})]}):0===J.length?(0,r.jsxs)("div",{className:"text-center py-4 text-gray-500",children:[(0,r.jsx)("p",{children:"No Aave positions found"}),(0,r.jsxs)("p",{className:"text-sm",children:["Connected to: ",ec]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm border-b border-gray-200 pb-2 text-gray-600 font-semibold",children:[(0,r.jsx)("p",{children:"Type"}),(0,r.jsx)("p",{children:"Collateral Token"}),(0,r.jsx)("p",{children:"Amount"})]}),J.map(e=>(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between bg-gray-100 p-4 rounded-md gap-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 w-full md:w-auto md:flex-grow",children:[(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("p",{className:"font-medium text-lg capitalize ".concat("collateral"===e.type?"text-green-600":"text-red-600"),children:e.type})}),(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("p",{className:"font-medium text-lg",children:e.token})}),(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("p",{className:"font-bold text-xl",children:e.formattedAmount})})]}),(0,r.jsx)(u,{asChild:!0,children:(0,r.jsx)(l.$,{onClick:()=>ev(e,"aaveToVault"),className:"bg-gradient-to-r from-accent-blue to-accent-purple hover:from-accent-purple hover:to-accent-blue text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-[0_0_15px_rgba(99,102,241,0.7)] w-full md:w-auto",children:"Migrate"})})]},e.id))]}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Please connect your wallet to view Aave positions"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:'Use the "Connect Wallet" button in the top right corner'})]})})]}),(0,r.jsxs)(o.Zp,{className:"bg-white border-gray-200 text-gray-900 transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/10 w-full",children:[(0,r.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,r.jsx)(o.ZB,{children:"Vault Position"}),ei&&(0,r.jsx)(l.$,{onClick:eA,disabled:es,variant:"outline",size:"sm",className:"text-xs",children:es?"Loading...":"Refresh"})]}),(0,r.jsx)(o.Wu,{className:"grid gap-4 max-h-[300px] overflow-y-auto",children:ei?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm border-b border-gray-200 pb-2 text-gray-600 font-semibold",children:[(0,r.jsx)("p",{children:"Type"}),(0,r.jsx)("p",{children:"Position"})]}),es?(0,r.jsx)("div",{className:"text-center py-4",children:"Loading PIV positions..."}):ea.length>0?ea.map(e=>(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between bg-gray-100 p-4 rounded-md gap-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 w-full md:w-auto md:flex-grow",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("p",{className:"font-medium text-lg capitalize",children:e.type}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.orderId?"Order: ".concat(e.orderId):"Direct"})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("p",{className:"font-medium text-lg",children:e.token}),(0,r.jsx)("p",{className:"font-bold text-xl",children:e.formattedAmount})]})]}),(0,r.jsx)(u,{asChild:!0,children:(0,r.jsx)(l.$,{onClick:()=>ev(e,"placeOrder"),className:"bg-gradient-to-r from-accent-blue to-accent-purple hover:from-accent-purple hover:to-accent-blue text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-[0_0_15px_rgba(99,102,241,0.7)] w-full md:w-auto",disabled:"debt"===e.type,children:"Create Order"})})]},e.id)):(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No PIV positions found. Migrate from Aave to create positions."}),!es&&0===ea.length&&H.map(e=>(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between bg-gray-100 p-4 rounded-md gap-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 w-full md:w-auto md:flex-grow",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("p",{className:"font-medium text-lg",children:e.debt.token}),(0,r.jsx)("p",{className:"font-bold text-xl",children:e.debt.amount})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("p",{className:"font-medium text-lg",children:e.collateral.token}),(0,r.jsx)("p",{className:"font-bold text-xl",children:e.collateral.amount})]})]}),(0,r.jsx)(u,{asChild:!0,children:(0,r.jsx)(l.$,{onClick:()=>ev(e,"placeOrder"),className:"bg-gradient-to-r from-accent-blue to-accent-purple hover:from-accent-purple hover:to-accent-blue text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-[0_0_15px_rgba(99,102,241,0.7)] w-full md:w-auto",children:"Place Order"})})]},e.id))]}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Please connect your wallet to view vault positions"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:'Use the "Connect Wallet" button in the top right corner'})]})})]})]}),(0,r.jsxs)(o.Zp,{className:"bg-white border-gray-200 text-gray-900 transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/10 w-full max-w-6xl",children:[(0,r.jsxs)(o.aR,{className:"flex flex-row items-center justify-between",children:[(0,r.jsx)(o.ZB,{children:"Order list"}),ei&&(0,r.jsx)(l.$,{onClick:ek,disabled:G,variant:"outline",size:"sm",className:"text-xs",children:G?"Loading...":"Refresh"})]}),(0,r.jsx)(o.Wu,{children:ei?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Owner"}),(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Collateral Token"}),(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Collateral Amount"}),(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Debt Token"}),(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Price"}),(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Status"}),(0,r.jsx)("th",{className:"text-left py-2 px-4 text-sm font-semibold text-gray-600",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:G?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"text-center py-4",children:"Loading orders..."})}):0===_.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No orders found"})}):_.map(e=>(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-2 px-4 text-sm font-medium truncate max-w-32",children:e.owner}),(0,r.jsx)("td",{className:"py-2 px-4 text-sm font-medium",children:e.collateralToken}),(0,r.jsx)("td",{className:"py-2 px-4 text-sm font-medium",children:e.collateralAmount}),(0,r.jsx)("td",{className:"py-2 px-4 text-sm font-medium",children:e.debtToken}),(0,r.jsx)("td",{className:"py-2 px-4 text-sm font-medium",children:K===e._id?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.p,{type:"number",value:$,onChange:e=>Z(e.target.value),className:"w-20 h-8 text-xs",placeholder:e.price.toString()}),(0,r.jsx)(l.$,{onClick:()=>eb(e._id,$),size:"sm",className:"h-6 px-2 text-xs bg-green-600 hover:bg-green-700",children:"✓"}),(0,r.jsx)(l.$,{onClick:()=>{X(null),Z("")},size:"sm",variant:"outline",className:"h-6 px-2 text-xs",children:"✕"})]}):e.price}),(0,r.jsx)("td",{className:"py-2 px-4 text-sm font-medium ".concat("OPEN"===e.status?"text-green-600":"FILLED"===e.status?"text-blue-600":"text-gray-600"),children:e.status}),(0,r.jsx)("td",{className:"py-2 px-4 text-sm",children:"OPEN"===e.status&&(0,r.jsx)("div",{className:"flex items-center gap-2",children:K!==e._id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.$,{onClick:()=>{X(e._id),Z(e.price.toString())},size:"sm",variant:"outline",className:"h-7 px-2 text-xs",children:"更新"}),(0,r.jsx)(l.$,{onClick:()=>ej(e._id),size:"sm",variant:"destructive",className:"h-7 px-2 text-xs",children:"取消订单"})]}):null})})]},e._id))})]})}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Please connect your wallet to view order list"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:'Use the "Connect Wallet" button in the top right corner'})]})})]})]}),(0,r.jsxs)(x,{className:"sm:max-w-[425px] bg-white text-gray-900",children:[(0,r.jsxs)(h,{children:[(0,r.jsx)(f,{children:"aaveToVault"===i?"Migrate AAVE Position to Vault":"Place Swap Order"}),(0,r.jsxs)(w,{children:["Enter the details for your ","aaveToVault"===i?"migration":"order",". Click confirm when you're done."]})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(y.J,{htmlFor:"collateral-token",className:"text-right",children:"Collateral Token"}),(0,r.jsxs)(b.l6,{value:m,onValueChange:g,children:[(0,r.jsx)(b.bq,{className:"col-span-3",children:(0,r.jsx)(b.yv,{placeholder:"Select collateral token"})}),(0,r.jsxs)(b.gC,{children:[a&&(0,r.jsx)(b.eb,{value:a.token,children:a.token}),(0,r.jsx)(b.eb,{value:"USDC",children:"USDC"}),(0,r.jsx)(b.eb,{value:"WBTC",children:"WBTC"}),(0,r.jsx)(b.eb,{value:"WETH",children:"WETH"}),(0,r.jsx)(b.eb,{value:"LINK",children:"LINK"}),(0,r.jsx)(b.eb,{value:"AAVE",children:"AAVE"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(y.J,{htmlFor:"collateral-amount",className:"text-right",children:"Collateral Amount"}),(0,r.jsx)(v.p,{id:"collateral-amount",type:"number",value:P,onChange:e=>E(e.target.value),className:"col-span-3",placeholder:"e.g., 1000"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(y.J,{htmlFor:"debt-token",className:"text-right",children:"Debt Token"}),(0,r.jsxs)(b.l6,{value:I,onValueChange:S,children:[(0,r.jsx)(b.bq,{className:"col-span-3",children:(0,r.jsx)(b.yv,{placeholder:"Select debt token"})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"USDC",children:"USDC"}),(0,r.jsx)(b.eb,{value:"WBTC",children:"WBTC"}),(0,r.jsx)(b.eb,{value:"WETH",children:"WETH"}),(0,r.jsx)(b.eb,{value:"LINK",children:"LINK"}),(0,r.jsx)(b.eb,{value:"AAVE",children:"AAVE"})]})]})]}),"aaveToVault"===i?(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(y.J,{htmlFor:"debt-amount",className:"text-right",children:"Debt Amount"}),(0,r.jsx)(v.p,{id:"debt-amount",type:"number",value:O,onChange:e=>T(e.target.value),className:"col-span-3",placeholder:"e.g., 500"})]}):(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(y.J,{htmlFor:"price",className:"text-right",children:"Price"}),(0,r.jsx)(v.p,{id:"price",type:"number",value:M,onChange:e=>D(e.target.value),className:"col-span-3",placeholder:"e.g., 1.05"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(y.J,{htmlFor:"rate-type",className:"text-right",children:"Interest Rate"}),(0,r.jsxs)(b.l6,{value:U,onValueChange:V,children:[(0,r.jsx)(b.bq,{className:"col-span-3",children:(0,r.jsx)(b.yv,{placeholder:"Select rate type"})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"static",children:"Static"}),(0,r.jsx)(b.eb,{value:"dynamic",children:"Dynamic"})]})]})]})]}),(0,r.jsx)(p,{children:(0,r.jsx)(l.$,{type:"submit",onClick:ey,disabled:eo,className:"bg-gradient-to-r from-accent-purple to-accent-pink hover:from-accent-pink hover:to-accent-purple text-white font-semibold",children:eo?"Processing...":"aaveToVault"===i?"Confirm Migration":"Create Order"})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[136,6938,780,6385,7218,3802,1671,4950,7358],()=>t(16910)),_N_E=e.O()}]);